<!-- jQuery first, then Bootstrap JS. -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<!-- Bootstrap JS -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.bundle.min.js"></script>

<nav class="navbar navbar-dark bg-dark fixed-top navbar-expand-md">
  <button class="navbar-toggler"
    type="button"
    data-toggle="collapse"
    data-target="#collapsingNavbar"
    aria-controls="navbarSupportedContent"
    aria-expanded="false"
    aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse"
    id="collapsingNavbar">
    <ul class="nav navbar-nav mr-auto">
      <!-- full size nav -->
      <li class="nav-item d-none d-sm-none d-md-block">
        <a class="nav-link"
          href="index#home">
          <img src="assets/Arkime_Logo_Mark_White@3x.png" />
        </a>
      </li>
      <li class="nav-item dropdown ml-4 d-none d-sm-none d-md-block">
        <a class="nav-link dropdown-toggle cursor-pointer main-home-link"
          data-toggle="dropdown"
          role="button"
          aria-haspopup="true"
          aria-expanded="false">
          <strong>Arkime</strong>
        </a>
        <div class="dropdown-menu">
          <a class="dropdown-item home-link"
            onclick="setActive('home')"
            href="index#home">
            Home
          </a>
          <a class="dropdown-item demo-link"
            onclick="setActive('demo')"
            href="index#demo">
            Demo
          </a>
          <a class="dropdown-item screenshots-link"
            onclick="setActive('screenshots')"
            href="index#screenshots">
            Screenshots
          </a>
          <a class="dropdown-item help-link"
            onclick="setActive('help')"
            href="index#help">
            Help
          </a>
        </div>
      </li>
      <li class="nav-item d-none d-sm-none d-md-block">
        <a class="nav-link downloads-link"
          href="downloads">
          Downloads
        </a>
      </li>
      <li class="nav-item d-none d-sm-none d-md-block">
        <a class="nav-link estimators-link"
          href="estimators">
          Estimators
        </a>
      </li>
      <li class="nav-item dropdown d-none d-sm-none d-md-block">
        <a class="nav-link dropdown-toggle cursor-pointer wiki-link"
          data-toggle="dropdown"
          role="button"
          aria-haspopup="true"
          aria-expanded="false">
          Learn
        </a>
        <div class="dropdown-menu">
          <a class="dropdown-item faq-link"
            href="faq">
            FAQ
          </a>
          <a class="dropdown-item settings-link"
            href="settings">
            Settings
          </a>
          <a class="dropdown-item api-link"
            href="allapis">
            API
          </a>
          <a class="dropdown-item learn-link"
            href="learn">
            Docs
          </a>
        </div>
      </li>
      <li class="nav-item dropdown d-none d-sm-none d-md-block">
        <a class="nav-link dropdown-toggle cursor-pointer galleries-link"
          data-toggle="dropdown"
          role="button"
          aria-haspopup="true"
          aria-expanded="false">
          Galleries
        </a>
        <div class="dropdown-menu">
          <a class="dropdown-item wise-configs-link"
            href="wise-configs">
            WISE Configs
          </a>
          <a class="dropdown-item rules-link"
            href="rules">
            Arkime Rules
          </a>
        </div>
      </li> <!-- /full size nav -->
      <!-- collapsed nav -->
      <div class="d-sm-block d-md-none pt-2 pb-2">
        <li class="nav-item">
          <a class="nav-link home-link pt-1 pb-1"
            href="index#home">
            <strong>Arkime Home</strong>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link downloads-link pt-1 pb-1"
            href="downloads">
            Downloads
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link estimators-link pt-1 pb-1"
            href="estimators">
            Estimators
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link faq-link pt-1 pb-1"
            href="faq">
            FAQ
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link settings-link pt-1 pb-1"
            href="settings">
            Settings
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link api-link pt-1 pb-1"
            href="allapis">
            API
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link learn-link pt-1 pb-1"
            href="learn">
            Docs
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link wise-config-link pt-1 pb-1"
            href="wise-configs">
            WISE 3.x Configs
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link rules-link pt-1 pb-1"
            href="rules">
            Arkime Rules
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link pt-1 pb-1"
            href="https://slackinvite.arkime.com/">
            Slack Us
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link pt-1 pb-1"
            href="https://github.com/arkime/arkime">
            Arkime GitHub
          </a>
        </li>
      </div> <!-- collapsed nav -->
    </ul>
    <form class="form-inline d-none d-sm-none d-md-block">
      <div class="switch-container" style="display:none;">
        <div class="switch">
          <div class="switch-btn"></div>
        </div>
        <span class="switch-label"></span>
      </div>
      <a href="https://slackinvite.arkime.com/"
        class="btn btn-sm btn-outline-danger ml-1"
        title="Join the conversation on Slack"
        data-toggle="tooltip"
        data-placement="left">
        <span class="fa fa-slack fa-2x"></span>
        <span class="hide">Slack Channel</span>
      </a>
      <a href="https://github.com/arkime/arkime"
        title="View Arkime on GitHub"
        data-toggle="tooltip" data-placement="left"
        class="btn btn-sm btn-outline-info ml-1">
        <span class="fa fa-github fa-2x"></span>
        <span class="hide">Arkime GitHub</span>
      </a>
    </form>
  </div>
</nav>

<script>
  const homeSubPaths = {
    home: true, demo: true, screenshots: true,
    download: true, help: true
  };

  const wikiSubPaths = {
    learn: true, faq: true, settins: true, api: true, wisesources: true
  }

  // on home section navlink click, set active class and remove others
  function setActive (page) {
    for (let sp in homeSubPaths) {
      $(`.${sp}-link`).removeClass('active');
    }

    $(`.${page}-link`).addClass('active');
  }

  function toggleTheme () {
    if (!document.body.classList.contains('dark-theme')) {
      document.body.classList.add('dark-theme');
      $('.switch-label').text('dark mode');
      localStorage.setItem('theme', 'dark');
    } else {
      document.body.classList.remove('dark-theme');
      $('.switch-label').text('light mode');
      localStorage.setItem('theme', 'light');
    }
  }

  // content loaded
  $(function () {
    $('[data-toggle="tooltip"]').tooltip();

    // set the active nav item
    let path = window.location.pathname.split('/')[1];
    let parentPath;

    if (!path || path === 'index') {
      parentPath = 'main-home';
      let hash = window.location.hash;

      if (hash) {
        path = hash.split('#')[1];
      }
    } else if (wikiSubPaths[path]) {
      parentPath = 'wiki';
    }

    $(`.${path}-link`).addClass('active');
    $(`.${parentPath}-link`).addClass('active');

    const themeSwitch = $('.switch-container');

    let darkMode;

    if (localStorage.getItem('theme')) {
      const savedTheme = localStorage.getItem('theme');
      darkMode = savedTheme === 'dark';
    } else {
      if (window.matchMedia) {
        darkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;
      }
    }

    if (darkMode) {
      document.body.classList.add('dark-theme');
      $('.switch-label').text('dark mode');
    } else {
      $('.switch-label').text('light mode');
    }

    themeSwitch[0].style.display = 'inline-block';
    themeSwitch.click(toggleTheme);
  });
</script>
